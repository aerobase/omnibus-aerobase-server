embed-server --server-config=standalone-full-ha.xml
/subsystem=datasources/data-source=KeycloakDS/:add(connection-url="<%= @jdbc_url %>",jta=false,driver-name=<%= @jdbc_driver_name %>,jndi-name=java:jboss/datasources/KeycloakDS,password=<%= @db_password %>,user-name=<%= @db_username %>,use-java-context=true,min-pool-size=5,max-pool-size=<%= @db_pool %>,validate-on-match=true,background-validation=true,background-validation-millis=10000,check-valid-connection-sql="select 1")
/subsystem=datasources/jdbc-driver=<%= @jdbc_driver_name %>:add(driver-name=<%= @jdbc_driver_name %>,driver-module-name=<%= @jdbc_driver_module_name %>,driver-xa-datasource-class-name=<%= @jdbc_driver_class_name %>)
/subsystem=infinispan/cache-container=keycloak:add()
/subsystem=infinispan/cache-container=keycloak/transport=TRANSPORT:add(lock-timeout=60000)
/subsystem=infinispan/cache-container=keycloak/local-cache=realms:add()
/subsystem=infinispan/cache-container=keycloak/local-cache=realms/memory=object:add(size="<%= @cache_size %>")
/subsystem=infinispan/cache-container=keycloak/local-cache=users:add()
/subsystem=infinispan/cache-container=keycloak/local-cache=users/memory=object:add(size="<%= @cache_size %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=sessions:add(owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=authenticationSessions:add(owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=offlineSessions:add(owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=clientSessions:add(owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=offlineClientSessions:add(owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=loginFailures:add(owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/local-cache=authorization:add()
/subsystem=infinispan/cache-container=keycloak/local-cache=authorization/memory=object:add(size="<%= @cache_size %>")
/subsystem=infinispan/cache-container=keycloak/replicated-cache=work:add()
/subsystem=infinispan/cache-container=keycloak/local-cache=keys:add()
/subsystem=infinispan/cache-container=keycloak/local-cache=keys/memory=object:add(size=1000)
/subsystem=infinispan/cache-container=keycloak/local-cache=keys/expiration=EXPIRATION:add(max-idle=3600000)
/subsystem=infinispan/cache-container=keycloak/distributed-cache=actionTokens:add(indexing="NONE",owners="<%= @cache_owners %>")
/subsystem=infinispan/cache-container=keycloak/distributed-cache=actionTokens/memory=object:add(size=-1)
/subsystem=infinispan/cache-container=keycloak/distributed-cache=actionTokens/expiration=EXPIRATION:add(max-idle=-1,interval=300000)
/extension=org.keycloak.keycloak-server-subsystem/:add(module=org.keycloak.keycloak-server-subsystem)
/subsystem=keycloak-server:add(web-context=auth,master-realm-name=master,scheduled-task-interval=900)
/subsystem=keycloak-server/theme=defaults/:add(dir=${jboss.home.dir}/themes,staticMaxAge=2592000,cacheTemplates=<%= @theme_cache %>,cacheThemes=<%= @theme_cache %>)
/subsystem=keycloak-server/spi=hostname/:add(default-provider=request)
/subsystem=keycloak-server/spi=hostname/provider=fixed/:add(properties={hostname => "localhost",httpPort => "-1",httpsPort => "-1"},enabled=true)
/subsystem=keycloak-server/spi=eventsStore/:add
/subsystem=keycloak-server/spi=eventsStore/provider=jpa/:add(properties={exclude-events => "[\"REFRESH_TOKEN\"]"},enabled=true)
/subsystem=keycloak-server/spi=userCache/:add
/subsystem=keycloak-server/spi=userCache/provider=default/:add(enabled=true)
/subsystem=keycloak-server/spi=userSessionPersister/:add(default-provider=jpa)
/subsystem=keycloak-server/spi=timer/:add(default-provider=basic)
/subsystem=keycloak-server/spi=connectionsHttpClient/:add
/subsystem=keycloak-server/spi=connectionsHttpClient/provider=default/:add(enabled=true)
/subsystem=keycloak-server/spi=connectionsJpa/:add
/subsystem=keycloak-server/spi=connectionsJpa/provider=default/:add(properties={dataSource => "java:jboss/datasources/KeycloakDS",initializeEmpty => "true",migrationStrategy => "update",migrationExport => "${jboss.home.dir}/keycloak-database-update.sql"},enabled=true)
/subsystem=keycloak-server/spi=realmCache/:add
/subsystem=keycloak-server/spi=realmCache/provider=default/:add(enabled=true)
/subsystem=keycloak-server/spi=connectionsInfinispan/:add(default-provider=default)
/subsystem=keycloak-server/spi=connectionsInfinispan/provider=default/:add(properties={cacheContainer => "java:jboss/infinispan/container/keycloak"},enabled=true)
/subsystem=keycloak-server/spi=jta-lookup/:add(default-provider=${keycloak.jta.lookup.provider:jboss})
/subsystem=keycloak-server/spi=jta-lookup/provider=jboss/:add(enabled=true)
/subsystem=keycloak-server/spi=publicKeyStorage/:add
/subsystem=keycloak-server/spi=publicKeyStorage/provider=infinispan/:add(properties={minTimeBetweenRequests => "10"},enabled=true)
